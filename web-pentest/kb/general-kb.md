## HTML

Browsers and Web-Application Firewalls and other pieces of software might parse HTML in different ways and where this happens, there well might be a vulnerability.

HTML5 introduced default behaviors to follow for browsers when parsing legacy HTML code, examples are:
- the **script** tag on its own will automatically be closed at the end of the page
-  a tag missing its closing angle bracket will automatically be closed by the angle bracket of the next tag on the page


________

## SOP (Same Origin Policy)

SOP is how the browser restricts a number of security-critical features:
- What domains can you contact via XMLHttpRequest
- Access the DOM across separate frames/windows

### Origin Matching

The way origin matching for SOP works is much more strict than cookies:
- Protocol must match otherwise meaning there is no crossing HTTP/HTTPS boundaries
- Port numbers must match
- Domain names must be and exact match meaning wildcards and subdomain walking are not allowed

It is possible for developers to loosen the grip that SOP has on their communications by changing document.domain, posting messages between windows and by using CORS (Cross-Origin Resource Sharing).
Every little change opens up new avenues for attack.


________

## CORS (Cross-Origin Resource Sharing)

CORS allows XMLHtppRequests outside the origin domain but with special headers.  
They even support sending and retrieval of cookies (going up to the remote server).

________

## CSRF (Cross-Site Request Forgery)

CRSF is when an attacker tricks a victim into going to a page controlled by the attacker, which then submits data to the target site _as_ the victim.  

CSRF tokens are randomnly generated and tied to users' sessions in order to prevent POST requests coming from unauthorized users (both logged-in and not logged-in).

Missing CSRF tokens in forms, of any kind, is to be considered a vulnerability, meaning a finding.

________

## The HTTP Protocol

HyperText Transfer Protocol (HTTP) is the standard protocol to access the World Wide Web (WWW). 

It was originally developed for retrieving static text-based resources and since then it has been extended and leveraged in various ways to enable it to support today's modern applications. It uses a message-based model in which a client send a request to the server and the server returns a response. 
Even though HTTP makes use of TCP, it is essentially connectionless. Each exchange of request and response is and autonomous transaction and may use a different TCP connection.  

### HTTP Requests

All HTTP messages (requests and responses) consist of one or more headers each on a separate line, a mandatory blank line and an optional message body.  
```http
GET /auth/488/YourDetails.ashx?uid=129 HTTP/1.1
Accept: application/x-ms-application, image/jpeg, application/xaml+xml, image/gif, image/pjpeg, application/x-ms-xbap, application/x-shockwave-flash, */*
Referer: https://mdsec.net/auth/488/Home.ashx
Access-Language: en-GB
User-Agent: Mozilla/4.0 (compatible: MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.52727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET4.0C; InfoPath.3; .NET4.0E; FDM; .NET CLR 1.1.4322)
Accept-Encoding: gzip, deflate
Host: mdsec.net
Connection: Keep-Alive
Cookie: SessionId=5B70C71F3FD4968935CDB668E545476
```
The first line of every HTTP message consists of a verb (GET), the requested URL (with parameter to be passed to the web application if needed marked by the _?_ character... in this case the param is _uid=129_) ancd the HTTP version being used.

The _Referer_ header is used to indicate the URL from whic the request originated. 

The _User-Agent_ header is used to provide information about the browser or any other piece of software used to generate the request. The Mozilla User-Agent is historically important because it was used in Netscape browsers. Due to its large usage, other browsers used the same USer-Agent to assert compatiblity with the protocol version.  
As of today it remains a "standard" because of its historical importance (but browsers, like Chrome, tend to use other User-Agent).  

The _Host_ header specifies the hostname that appeared in the full URL being accessed. This header becomes very important when multiple sites are hosted on the same server.  

The _Cookie_ header is used to submit additional parameters that the server has issued to the client.  

### HTTP Response

A tipical HTTP Response:

```http
HTTP/1.1 200 OK
Date: Tue, 19 Apr 2011 09:23:32 GMT
Server: Microsoft-IIS/6.0
X-Powered-By: ASP.NET
Set-Cookie: tracking=tI8rk7joMx44S2Uu85nSWc
X-AspNet-Version: 2.0.50727
Cache-Control: no-cache
Pragma: no-cache
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 1069

[BODY]
```

The first line of each response consist in the HTTP version being used, a numeric status code indicating the result of the request, a textual value further indicating the result of the request (no use for today's browsers).  

The _Server_ header indicates the web server software being used, it may contain names of modules installed. This information may or may not be accurate.  

The _Set-Cookie_ header contains cookies passed from the server to the client. The client must store the value and use it for every subsequent request.  

The _Pragma_ header instructs the browser not to store the response in its cache. The _Expires_ header indicates that the response content expired in the past and the browser is not meant to store it. The use of these headers is commoly adopted where dynamic content is used, in this way browsers always obtain the fresh and latest versio of the content.  

The _Content-Type_ header indicates the body's content type (in the example, html) while the _Content-Length_ header indicates the length of the body.  

Between headers and body there is a blank line.  

### HTTP Methods

The two most common HTTP methods are GET and POST.  

The GET method is used to retrieve resources. It can be used to send parameters which will be added to the URL. When a webpage is bookmarked, parameters are saved in the bookmark and other users who use the query will get the same page.  
In case of external links, URL requested using the GET method populates the _Referer_ header along with any parameter. This is why the GET method should never be trusted to send sensitive information.  

The POST method is used to perform actions. Parameters can be sent along withe the URL or in the body of the message. Although the URL can still be bookmarked, parameters are excluded from the bookmark. Furthermore, since POST is meant to perform actions, calling the same request will cause browsers to warn users about before repeating the same action twice.  

Besides _GET_ and _POST_, other methods are:

- _HEAD_ functions the same way as GET but the body is omitted from the response. The server is meant to return only the headers which are the same returned for a GET request, meaning this way could be useful for checking whether a resource exists before making a GET request.  
- _TRACE_ is designed for diagnostic purpose because the server is supposed to return in the message body the request received. In this way it should be easy to detect sort of "MiTM" attacks.
- _OPTIONS_ asks the server for a list of allowed HTTP methods for a specific resource.
- _PUT_ attempts to upload aa resource to the server. If the method is allowed it can be used to upload arbitrary file like scripts that will be executed on the server.  

### URL

A uniform resource locator (URL) is a unique identifier for web resources, its format is:  ```protocol://hostname[:port]/[path/]file[?param=value]```.  
