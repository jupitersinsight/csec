## HTML

Browsers and Web-Application Firewalls and other pieces of software might parse HTML in different ways and where this happens, there well might be a vulnerability.

HTML5 introduced default behaviors to follow for browsers when parsing legacy HTML code, examples are:
- the **script** tag on its own will automatically be closed at the end of the page
-  a tag missing its closing angle bracket will automatically be closed by the angle bracket of the next tag on the page


________

## SOP (Same-Origin Policy)

SOP is how the browser restricts a number of security-critical features:
- What domains can you contact via XMLHttpRequest
- Access the DOM across separate frames/windows

Some key features of Same-Origin Policy are:
- A page residing on one domain can cause and arbitrary request to be made to another domain (for example, by submitting a form or loading an image). But it cannot itself process tha data returned from that request.
- A page residing on one domain can load a script from another domain and execute this within its context. This is because scripts are assumed to contain code, rather than data, so cross-domain access should not lead to disclosure of any sensitive information.
- A page residing on one domain cannot read or modify the cookies or other DOM data belonging to another domain.

It prevents web applications from reading responses to requests between them.  
It does not prevent writing but reading.

### Origin Matching

The way origin matching for SOP works is much more strict than cookies:
- Protocol must match otherwise meaning there is no crossing HTTP/HTTPS boundaries
- Port numbers must match
- Domain names must be and exact match meaning wildcards and subdomain walking are not allowed

It is possible for developers to loosen the grip that SOP has on their communications by changing document.domain, posting messages between windows and by using CORS (Cross-Origin Resource Sharing).
Every little change opens up new avenues for attack.


________

## CORS (Cross-Origin Resource Sharing)

CORS allows XMLHtppRequests outside the origin domain but with special headers.  
They even support sending and retrieval of cookies (going up to the remote server).

### What is the Access-Control-Allow-Origin response header?

The _Access-Control-Allow-Origin_ header is included in the response from one website to a request originating from another website, and identifies the permitted origin of the request. A web browser compares the Access-Control-Allow-Origin with the requesting website's origin and permits access to the response if they match.

### Implementing simple cross-origin resource sharing

The cross-origin resource sharing (CORS) specification prescribes header content exchanged between web servers and browsers that restricts origins for web resource requests outside of the origin domain. The CORS specification identifies a collection of protocol headers of which _Access-Control-Allow-Origin_ is the most significant. This header is returned by a server when a website requests a cross-domain resource, with an _Origin_ header added by the browser.

For example, suppose a website with origin normal-website.com causes the following cross-domain request:

```http
GET /data HTTP/1.1
Host: robust-website.com
Origin : https://normal-website.com
The server on robust-website.com returns the following response:
```
```http
HTTP/1.1 200 OK
...
Access-Control-Allow-Origin: https://normal-website.com
```

The browser will allow code running on normal-website.com to access the response because the origins match.


The specification of Access-Control-Allow-Origin allows for multiple origins, or the value null, or the wildcard *. However, no browser supports multiple origins and there are restrictions on the use of the wildcard *.

### Handling cross-origin resource requests with credentials

The default behavior of cross-origin resource requests is for requests to be passed without credentials like cookies and the Authorization header.  

However, the cross-domain server can permit reading of the response when credentials are passed to it by setting the CORS Access-Control-Allow-Credentials header to true. Now if the requesting website uses JavaScript to declare that it is sending cookies with the request:

```http
GET /data HTTP/1.1
Host: robust-website.com
...
Origin: https://normal-website.com
Cookie: JSESSIONID=<value>
```

And the response to the request is:

```http
HTTP/1.1 200 OK
...
Access-Control-Allow-Origin: https://normal-website.com
Access-Control-Allow-Credentials: true
```

Then the browser will permit the requesting website to read the response, because the Access-Control-Allow-Credentials response header is set to true. Otherwise, the browser will not allow access to the response.

A cross-domain server response of the form:

```http
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true
```

is not permitted as this would be dangerously insecure, exposing any authenticated content on the target site to everyone.






