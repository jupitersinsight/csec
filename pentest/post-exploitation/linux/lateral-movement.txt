SSH gives the opportunity for multiplexed connections, meaning that through one legit session the user can "spawn" other 
sessions with other systems.
The first connection which requires valide credentials, does allow the creation of other sessions that rely on the first
authenticated session.
This feature name is ControlMaster.

To make the experience smoother, organizations may employ the use of ssh-agent which is a process that allows authentication
via a local socket file. When authenticating to a remote system, it is possible to make available the ssh-agent on it using
the FowardAgent command. By forwarding the agent, a user can move around remote systems without having to copy keys or 
re-authenticating manually.

Even though the purpose is to ease the use of SSH connections to remote devices, ControlMaster introduces in the environment
a viable way for attackers to hijack an existing session and "spwan" other sessions.
In this way the attacker achieves lateral movement to other systems in the network without knowing the victim credentials
and without having his private keys.

Example:
. ps aux | grep sshd (determine SSH process ID of the user on the compromised host)
. grep SSH_AUTH_SOCK /proc/[PID]/environ (determine the SSH_AUTH_SOCK environment variable for the sshd PID)
. SSH_AUTH_SOCK=/tmp/ssh-XXXXXXX/agent.XXXX ssh-add -1 (hijack the target sshd socket)
. ssh remote_system -l victim

Another way to make use of SSH for lateral movement consists into setting a server and redirected victim's SSH connections
attempts to it.
In this the way attacker can log POST requests and collect cleartext credentials.
Name of tool: sshLooter.git


VPNPivot allows the creation of a VPN tunnel between the compromised host and the attacker machine, bypassing NAT and
firewall devices.


The python script firefox_decrypt.py can decrypt password stores in 
/home/[USER]/.mozilla/firefox/[RANDOM_PROFILE].default/logins.json.
When copied over to the compromised system and executed, the script will return stores credentials.
It does work only when the MasterPassowrd has NOT been set.


