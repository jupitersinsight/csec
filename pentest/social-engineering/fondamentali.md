### Sender Policy Framework (SPF)
Nativamente SMTP non ha mezzi per verificare se l'indirizzo del mittente appartiene effettivamente al vero proprietario.  
**SPF** è uno standard per verificarlo: il proprietario del dominio inserisce una lista di host autorizzati nei record DNS per quel dominio sottoforma di record TXT.  
Quando SPF è in uso il mail server che riceve i messaggi tramite SMTP per l'invio, controlla la lista dei record TXT e in caso di riscontro negativo il messaggio è rifiutato.  
**SPF NON VERIFICA L'HEADER _FROM_ DEL MESSAGGIO**  

Perché SPF funzioni correttamente bisogna che:
- il mail server che riceve il messaggio deve verificare il record SPF
- il proprietario del dominio deve creare il record SPF

Per trovare il record SPF di un dominio si usa il comando: _dig +short TXT [NOME DOMINIO]_

### DomainKeys Identified Mail (DKIM)
A differenza di SPF, DKIM è uno standard di protezione dei mail server in grado di verificare il contenuto del messaggio.  
Il mail server firma il messaggio e il suo contenuto usando un header DKIM-Signature in modo che altri attori in gioco possano verificare l'origine del messaggio.  
Il procedimento di verifica dell'autenticità del messaggio prevede che un server ricorra a una query DNS per individuare e recuperare la chiave pubblica del server di origine.  
Attraverso tale chiave pubblica si può verificare l'autenticità del messaggio.  

Il comando per verificare il valore di DKIM: _dig dkim.\_domainkey.[NOME DOMINIO] TXT_  

Affinché DKIM funzioni correttamente è necessaria una certa collaorazione tra il proprietario del dominio e il mail provider di modo che un messaggio senza firma DKIM sia segnalato come sospetto.  
DMARC arriva in aiuto in questa collaborazione.  

### Domain-based Message Authentication, Reporting and Conformance (DMARC)
DMARC è uno standard che permette al proprietario di:
- annunciare l'utilizzo di DKIM e SPF
- "consigliare" agli altri mail server quali azioni intraprendere in caso un messaggio sospetto.  

Per verificare se un dominio usa DMARC il comando è: _dig +short TXT \_dmarc.[NOME DOMINIO]  


**Affinché DMARC, DKIM e SPF funzionino correttamente i mail server che ricevono i messaggi devono attivamente verificare i messaggi, appunto**  


### Accepted Domains
Feature in Microsoft Exchange che aiuta nel proteggere l'identità degli utenti del dominio in assenza di SPF, DKIM e DMARC.  

### Spam Traps
Honeypot dedicate alla cattura delle email di spam giudicate in base a criteri come:
- Età del dominio
- Link che puntano a indirizzi IP
- Tecniche di manipolazione dei link
- Allegati sospetti o poco comuni
- Contenuto dell'email incompleto o corrotto
- Valori usati diversi da quelli specificati nell'header
- Certificati SSL validi
- Trasmissione delle pagine web (linkate?) a servizi ad-hoc di web filtering

### Come aggirare le difese
Prima di tutto verificare la presenza per quel dominio di SPF, DKIM e DMARC.  
Successivamente inviare una email da un utente insesistente per ispezionare l'header della risposta di mancato recapito alla ricerca di informazioni utili.  
Infine, se lo spoofing si rivela essere una via non percorribile, attivare un vero dominio che sia utile alla campagna di social engineering che si ha in mente.  
Sullo stesso dominio attivare SPF, DKIM e DMARC.

-----------------------

### Macro
Quando si parla di Macro si parla quasi solamente e sicuramente del pacchetto Office e di Windows.  
Il codice **Visual Basic for Applications** (VBA) può essere incluso in file di Microsoft Office, con lo scopo di automatizzare azioni e processi o interagire le API di Windows.  
Dagli anni '90 fino al 2003 le Macro erano il principale vettore di attacco via social-engineering in quando Microsoft Office le eseguiva di default e non erano presenti particolari contromisure.  
Dal 2003, Microsoft Office non esegue le Macro per impostazione predefinita e avvisa l'utente finale tramite avvisi.  
Dal 2007, Microsoft Office non presenta più la possibilità di incorporare Macro nei file Word grazie all'introduzione dello standard XML OfficeOpen da cui sono derivati 4 nuovi tipi di file: DOCX, DOTX, DOCM, DOTM.  
Per impostazione predefinita Office associa le estensioni ai programmi che lo costituiscono (Word, Excel...).  

All'apertura di file DOCX o comunque legati a Microsoft Word, lo stesso software esegue un controllo di validazione del file analizzandone la struttura basandosi sullo standard XML OfficeOpen. Tale operazione è a carico del file WWLIB.dll.  
Durante questa fase di verifica e analisi l'estensione del file non è tenuta in considerazione.  

I file DCOM, che contengono codice VBA eeguibile, possono essere rinominati con estensioni di altri file e mantenere intatta la capacità di eseguire il codice.  
Ad esempio, un file DCOM può essere rinominato con estensione RTF (che di predefinito non supporta le Macro) ed essere avviato per eseguire il codice.  
Lo stesso discorso vale per gli altri programmi inclusi in Office, come Excel, PowerPoint...

I seguenti comandi restituiscono liste di estensioni associate ai programmi Office e che potrebbero supportare l'esecuzione di Macro:
- _assoc | findstr /i "word"_
- _assoc | findstr /i "excel"_
- _assoc | findstr /i "powerp"_

Una particolarità in Word riguarda i **Template remoti**.  
Un file DOCX che faccia riferimento a un Template remoto che include Macro è in grado anche di eseguirle.
Per associare un file a un Template remoto: _File - Opzioni - Componenti Aggiuntivi - Gestici: Modelli - Vai_
